# SPDX-License-Identifier: MIT OR Apache-2.0
#
# Copyright (c) 2023 SUSE LLC
#
# Author: Roy Hopkins <rhopkins@suse.de>

language = "C"

header = """
/* 
 * SPDX-License-Identifier: MIT OR Apache-2.0
 *
 * Copyright (c) 2023 SUSE LLC
 *
 * Author: Roy Hopkins <rhopkins@suse.de>
 */
"""

include_guard = "IGVM_DEFS_H"

autogen_warning = "/* This file is generated using cbindgen. Do not edit this file directly. */"

include_version = true

after_includes = """

typedef struct {
    uint32_t is_2mb_page : 1;
    uint32_t unmeasured : 1;
    uint32_t reserved : 30;
} IgvmPageDataFlags;

typedef struct {
    uint32_t vtl2_protectable : 1;
    uint32_t reserved : 31;
} RequiredMemoryFlags;

typedef struct {
    uint16_t is_shared : 1;
    uint16_t reserved : 15;
} MemoryMapEntryFlags;

typedef struct {
    uint32_t memory_is_shared : 1;
    uint32_t reserved : 31;
} IgvmEnvironmentInfo;

typedef uint64_t IGVM_U64_LE;
typedef uint32_t IGVM_U32_LE;

#define IGVM_UINT32_FLAGS_VALUE(x) *((uint32_t*)&(x))
"""

[export]
include = ["IGVM_FIXED_HEADER", 
    "IGVM_VHS_VARIABLE_HEADER",
    "IGVM_VHS_SUPPORTED_PLATFORM", 
    "IGVM_VHS_GUEST_POLICY", 
    "GuestPolicy", 
    "SnpPolicy", 
    "TdxPolicy", 
    "IGVM_VHS_RELOCATABLE_REGION", 
    "IGVM_VHS_PAGE_TABLE_RELOCATION", 
    "IGVM_VHS_PARAMETER_AREA", 
    "IGVM_VHS_PAGE_DATA", 
    "IGVM_VHS_PARAMETER_INSERT", 
    "IGVM_VHS_PARAMETER", 
    "IGVM_VHS_VP_CONTEXT", 
    "VbsVpContextHeader", 
    "VbsVpContextRegister", 
    "IGVM_VHS_REQUIRED_MEMORY", 
    "IGVM_VHS_MEMORY_RANGE", 
    "IGVM_VHS_MMIO_RANGES", 
    "IGVM_VHS_SNP_ID_BLOCK_SIGNATURE", 
    "IGVM_VHS_SNP_ID_BLOCK_PUBLIC_KEY", 
    "IGVM_VHS_SNP_ID_BLOCK", 
    "IGVM_VHS_VBS_MEASUREMENT", 
    "IGVM_VHS_MEMORY_MAP_ENTRY", 
    "IGVM_VHS_ERROR_RANGE"]

exclude = ["IgvmPageDataFlags", "RequiredMemoryFlags", "MemoryMapEntryFlags"]

[export.rename]
"MemoryMapEntryType" = "IgvmMemoryMapEntryType"
"SnpPolicy" = "IgvmSnpPolicy"
"TdxPolicy" = "IgvmTdxPolicy"
"VbsVpContextHeader" = "IgvmVbsVpContextHeader"
"VbsVpContextRegister" = "IgvmVbsVpContextRegister"
"PAGE_SIZE_4K" = "IGVM_PAGE_SIZE_4K"
"u64_le" = "IGVM_U64_LE"
"u32_le" = "IGVM_U32_LE"