# SPDX-License-Identifier: MIT OR Apache-2.0
#
# Copyright (c) 2023 SUSE LLC
#
# Author: Roy Hopkins <rhopkins@suse.de>

language = "C"

header = """
/* 
 * SPDX-License-Identifier: MIT OR Apache-2.0
 *
 * Copyright (c) 2023 SUSE LLC
 *
 * Author: Roy Hopkins <rhopkins@suse.de>
 */
"""

trailer = """
#undef INVALID
#define INVALID 0
"""

include_guard = "IGVM_DEFS_H"

pragma_once = true

autogen_warning = "/* This file is generated using cbindgen. Do not edit this file directly. */"

include_version = true

after_includes = """
typedef struct {
    uint32_t is_2mb_page : 1;
    uint32_t unmeasured : 1;
    uint32_t reserved : 30;
} IgvmPageDataFlags;

typedef struct {
    uint32_t vtl2_protectable : 1;
    uint32_t reserved : 31;
} RequiredMemoryFlags;

typedef struct {
    uint16_t is_shared : 1;
    uint16_t reserved : 15;
} MemoryMapEntryFlags;

typedef struct {
    uint32_t memory_is_shared : 1;
    uint32_t reserved : 31;
} IgvmEnvironmentInfo;

typedef uint64_t u64_le;
typedef uint32_t u32_le;

#define UINT32_FLAGS_VALUE(x) *((uint32_t*)&(x))

// Rust enums are scoped so can contain entries that are duplicated between
// different enums. This is not the case in C. There are multipe IGVM enums
// that define a value for INVALID so create a macro that uniquely names them.
// This is #undef'd at the end of the file and redefined as 0.
#define MAKE_INVALID_IMPL(x, y) x##y
#define MAKE_INVALID(x, y) MAKE_INVALID_IMPL(x, y)
#define INVALID MAKE_INVALID(INVALID_, __COUNTER__)
"""

[export]
include = ["IGVM_FIXED_HEADER", 
    "IGVM_VHS_VARIABLE_HEADER",
    "IGVM_VHS_SUPPORTED_PLATFORM", 
    "IGVM_VHS_GUEST_POLICY", 
    "GuestPolicy", 
    "SnpPolicy", 
    "TdxPolicy", 
    "IGVM_VHS_RELOCATABLE_REGION", 
    "IGVM_VHS_PAGE_TABLE_RELOCATION", 
    "IGVM_VHS_PARAMETER_AREA", 
    "IGVM_VHS_PAGE_DATA", 
    "IGVM_VHS_PARAMETER_INSERT", 
    "IGVM_VHS_PARAMETER", 
    "IGVM_VHS_VP_CONTEXT", 
    "VbsVpContextHeader", 
    "VbsVpContextRegister", 
    "IGVM_VHS_REQUIRED_MEMORY", 
    "IGVM_VHS_MEMORY_RANGE", 
    "IGVM_VHS_MMIO_RANGES", 
    "IGVM_VHS_SNP_ID_BLOCK_SIGNATURE", 
    "IGVM_VHS_SNP_ID_BLOCK_PUBLIC_KEY", 
    "IGVM_VHS_SNP_ID_BLOCK", 
    "IGVM_VHS_VBS_MEASUREMENT", 
    "IGVM_VHS_MEMORY_MAP_ENTRY", 
    "IGVM_VHS_ERROR_RANGE"]

exclude = ["IgvmPageDataFlags", "RequiredMemoryFlags", "MemoryMapEntryFlags"]
